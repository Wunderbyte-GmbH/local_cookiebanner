{"version":3,"file":"db.min.js","sources":["../src/db.js"],"sourcesContent":["/**\n * @module local_cookiebanner/db\n * @copyright 2024\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nconst DB_NAME = 'local_cookiebanner_db';\nconst STORE_NAME = 'prefs';\n\nexport function openDB() {\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, 1);\n        request.onupgradeneeded = function (event) {\n            const db = event.target.result;\n            if (!db.objectStoreNames.contains(STORE_NAME)) {\n                db.createObjectStore(STORE_NAME, { keyPath: 'key' });\n            }\n        };\n        request.onsuccess = () => resolve(request.result);\n        request.onerror = () => reject(request.error);\n    });\n}\n\nexport async function getDBItem(key) {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(key);\n    return new Promise((resolve, reject) => {\n        request.onsuccess = () => resolve(request.result?.value ?? null);\n        request.onerror = () => reject(request.error);\n    });\n}\n\nexport async function setDBItem(key, value) {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.put({ key, value });\n    return new Promise((resolve, reject) => {\n        tx.oncomplete = () => resolve();\n        tx.onerror = () => reject(tx.error);\n    });\n}\n"],"names":["key","tx","openDB","transaction","request","objectStore","get","Promise","resolve","reject","onsuccess","result","value","onerror","error","STORE_NAME","put","oncomplete","indexedDB","open","onupgradeneeded","event","db","target","objectStoreNames","contains","createObjectStore","keyPath"],"mappings":"yJAsBgCA,WAEtBC,UADWC,UACHC,YAlBC,QAkBuB,YAEhCC,QADQH,GAAGI,YAnBF,SAoBOC,IAAIN,YACnB,IAAIO,SAAQ,CAACC,QAASC,UACzBL,QAAQM,UAAY,gCAAMF,iCAAQJ,QAAQO,yDAAQC,QAAS,OAC3DR,QAAQS,QAAU,IAAMJ,OAAOL,QAAQU,oEAIfd,IAAKY,aAE3BX,UADWC,UACHC,YA7BC,QA6BuB,oBACxBF,GAAGI,YAAYU,YACvBC,IAAI,CAAEhB,IAAAA,IAAKY,MAAAA,QACV,IAAIL,SAAQ,CAACC,QAASC,UACzBR,GAAGgB,WAAa,IAAMT,UACtBP,GAAGY,QAAU,IAAMJ,OAAOR,GAAGa;;;;;;MAlC/BC,WAAa,iBAEHb,gBACL,IAAIK,SAAQ,CAACC,QAASC,gBACnBL,QAAUc,UAAUC,KALlB,wBAKgC,GACxCf,QAAQgB,gBAAkB,SAAUC,aAC1BC,GAAKD,MAAME,OAAOZ,OACnBW,GAAGE,iBAAiBC,SAPlB,UAQHH,GAAGI,kBARA,QAQ8B,CAAEC,QAAS,SAGpDvB,QAAQM,UAAY,IAAMF,QAAQJ,QAAQO,QAC1CP,QAAQS,QAAU,IAAMJ,OAAOL,QAAQU"}